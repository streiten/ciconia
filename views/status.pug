extends layout

block content
  .row
    .col-sx-12
      h1 Status
      h2 Individuals
      if individuals
        h3 Active
        table.table.table-striped.table-hover
          tr
            th Id
            th Name
            th Last Event
            th Action
          
          for individual in individuals
            if individual.active
              tr
                td= individual.id
                td= individual.name
                td
                  span.lastEventDate= individual.lastEventAt
                  | 
                  a(href='#' data-animalid=individual.id).update-lastEventAt 
                   | 
                   i.fa.fa-refresh
                td
                  a(href='/individual/' + individual.id ) View Details <br>
                  a(href='/story/' + individual.id ).generate-content View current story <br>
                  a(href='#' data-animalid=individual.id).update-story-data Update story data <br>

        h3 Inactive
        table.table.table-striped.table-hover
          tr
            th Id
            th Name
            th Last Update
            th Action
          
          for individual in individuals
            if !individual.active
              tr
                td= individual.id
                td= individual.name
                td
                  span.lastEventDate= individual.lastEventAt
                  | 
                  a(href='#' data-animalid=individual.id).update-lastEventAt 
                   | 
                   i.fa.fa-refresh                
                td
                  a(href='/individual/' + individual.id ) View Details <br>
                  a(href='/story/' + individual.id ).generate-content View current story <br>
                  - var animalId = individual.id
    
    script.
      $(document).ready(function() {

        var socket = io.connect();
        
        socket.on('lastEventUpdate', data => {
          
          $('*[data-animalid="' + data.id + '"]').parent().find('.lastEventDate').html(data.lastEvent.timestamp);

        });

        $('.update-story-data').on('click',function(e){
          e.preventDefault();
          socket.emit('updateStoryData', { 'id': $(this).data("animalid")  } );
        });

        $('.update-lastEventAt').on('click',function(e){
          e.preventDefault();
          socket.emit('updateLastEvent', { 'id': $(this).data('animalid')  } );
        });

      });